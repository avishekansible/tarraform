trigger:
 - master

pool:
  vmImage: 'ubuntu-latest'

parameters:
  - name: components
    type: object
    default:
     - resourcegroup
     - storageaccount
     
steps:
 - task: TerraformInstaller@0
   displayName: Install
   inputs:
     terraformVersion: '0.13.7'

 - ${{ each value in parameters.components }}:
   - task: TerraformTaskV2@2
     displayName: Init on ${{ value }}
     inputs:
       provider: 'azurerm'
       command: 'init'
       workingDirectory: '$(System.DefaultWorkingDirectory)/${{ value }}'
       backendServiceArm: 'azure-test1'
       backendAzureRmResourceGroupName: 'terraform-rg'
       backendAzureRmStorageAccountName: 'aviaccount'
       backendAzureRmContainerName: 'avicontainer'
       backendAzureRmKey: 'terraform.tfstate'
   
 